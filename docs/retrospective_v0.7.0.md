# Retrospective (v0.7.0)

This repo is intentionally **demo-scoped** but **production-shaped**. This retrospective documents concrete issues found during review, why they matter, and what was shipped to fix them.

## 1) Security correctness: snippet boundary leak

**Issue:** Snippets were generated by slicing text first and then applying redaction. If a secret pattern crossed the 160-character snippet boundary, the slice could truncate the pattern and prevent the regex from matching, leaking a prefix.

**Fix:** The pipeline now **redacts the full document body first, then slices**.

**Proof:** A regression test (`test_redaction_happens_before_snippet_slicing`) covers the boundary case.

## 2) Observability: request correlation / trace continuity

**Issue:** The service generated a fresh request id for every request, ignoring a safe upstream `X-Request-Id`. That breaks correlation in distributed systems.

**Fix:**
- The gateway now **honors a safe, bounded `X-Request-Id`** when present.
- A `ContextVar` propagates `request_id` through async call chains so every JSON log line is correlated.

## 3) Repo hygiene + reproducibility

**Issue:** Reviewers lose trust quickly when build artifacts, state, or local environments appear in the repo tree or in commits.

**Fix:**
- Tightened `.gitignore` for Python + Terraform.
- `make gate` now bootstraps a venv on demand and runs the full regression harness.

## 4) Known limitations (intentional)

- **InMemoryStore** is used by default: it is cheap, deterministic, and perfect for demoing invariants, but it is not durable or concurrency-safe for real production use on Lambda.
- Retrieval uses **deterministic lexical search**: security enforcement must be deterministic; semantic relevance can be layered behind the same boundary later.
